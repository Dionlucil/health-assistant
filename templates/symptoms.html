{% extends "base.html" %}

{% block title %}Symptom Checker - Community Health Assistant{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <!-- Header -->
            <div class="text-center mb-5">
                <h1 class="display-5 fw-bold text-primary">
                    <i class="fas fa-stethoscope me-3"></i>Symptom Checker
                </h1>
                <p class="lead text-muted">
                    Describe your symptoms and get AI-powered health insights and recommendations
                </p>
            </div>

            <!-- Symptoms Form -->
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-clipboard-list me-2"></i>Tell Us About Your Symptoms
                    </h4>
                </div>
                <div class="card-body p-4">
                    <form id="symptomsForm">
                        <!-- Symptom Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-list-check me-2"></i>Select Your Symptoms
                            </label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="fever" id="fever">
                                        <label class="form-check-label" for="fever">
                                            <i class="fas fa-thermometer-half text-danger me-2"></i>Fever
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="headache" id="headache">
                                        <label class="form-check-label" for="headache">
                                            <i class="fas fa-brain text-warning me-2"></i>Headache
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="cough" id="cough">
                                        <label class="form-check-label" for="cough">
                                            <i class="fas fa-lungs text-info me-2"></i>Cough
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="fatigue" id="fatigue">
                                        <label class="form-check-label" for="fatigue">
                                            <i class="fas fa-tired text-secondary me-2"></i>Fatigue
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="nausea" id="nausea">
                                        <label class="form-check-label" for="nausea">
                                            <i class="fas fa-stomach text-success me-2"></i>Nausea
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="sore_throat" id="sore_throat">
                                        <label class="form-check-label" for="sore_throat">
                                            <i class="fas fa-comment-medical text-danger me-2"></i>Sore Throat
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="runny_nose" id="runny_nose">
                                        <label class="form-check-label" for="runny_nose">
                                            <i class="fas fa-tint text-info me-2"></i>Runny Nose
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="muscle_aches" id="muscle_aches">
                                        <label class="form-check-label" for="muscle_aches">
                                            <i class="fas fa-dumbbell text-warning me-2"></i>Muscle Aches
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="dizziness" id="dizziness">
                                        <label class="form-check-label" for="dizziness">
                                            <i class="fas fa-spinner text-secondary me-2"></i>Dizziness
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="chest_pain" id="chest_pain">
                                        <label class="form-check-label" for="chest_pain">
                                            <i class="fas fa-heart text-danger me-2"></i>Chest Pain
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Severity -->
                        <div class="mb-4">
                            <label for="severity" class="form-label fw-bold">
                                <i class="fas fa-exclamation-triangle me-2"></i>Symptom Severity
                            </label>
                            <select class="form-select" id="severity" required>
                                <option value="">Select severity level</option>
                                <option value="mild">Mild - Noticeable but not interfering with daily activities</option>
                                <option value="moderate">Moderate - Somewhat interfering with daily activities</option>
                                <option value="severe">Severe - Significantly interfering with daily activities</option>
                            </select>
                        </div>

                        <!-- Duration -->
                        <div class="mb-4">
                            <label for="duration" class="form-label fw-bold">
                                <i class="fas fa-clock me-2"></i>Duration
                            </label>
                            <select class="form-select" id="duration" required>
                                <option value="">Select duration</option>
                                <option value="less_than_day">Less than a day</option>
                                <option value="1_3_days">1-3 days</option>
                                <option value="4_7_days">4-7 days</option>
                                <option value="1_2_weeks">1-2 weeks</option>
                                <option value="2_4_weeks">2-4 weeks</option>
                                <option value="more_than_month">More than a month</option>
                            </select>
                        </div>

                        <!-- Additional Information -->
                        <div class="mb-4">
                            <label for="additional_info" class="form-label fw-bold">
                                <i class="fas fa-edit me-2"></i>Additional Information
                            </label>
                            <textarea class="form-control" id="additional_info" rows="3" 
                                      placeholder="Please provide any additional details about your symptoms, medical history, or concerns..."></textarea>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5" id="submitBtn">
                                <i class="fas fa-search me-2"></i>Analyze Symptoms
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results Section (Hidden by default) -->
            <div id="resultsSection" class="mt-5" style="display: none;">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-clipboard-check me-2"></i>Analysis Results
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <div id="analysisResults">
                            <!-- Results will be populated here -->
                        </div>
                        
                        <!-- Chat with AI Doctor Button -->
                        <div class="text-center mt-4">
                            <a href="{{ url_for('ai_doctor_page') }}" class="btn btn-info btn-lg px-5">
                                <i class="fas fa-comments me-2"></i>Chat with AI Doctor for More Clarification
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Disclaimer -->
            <div class="alert alert-warning mt-4" role="alert">
                <h6 class="alert-heading">
                    <i class="fas fa-exclamation-triangle me-2"></i>Medical Disclaimer
                </h6>
                <p class="mb-0">
                    This symptom checker provides general health information only. It is not a substitute for professional medical advice, diagnosis, or treatment. 
                    Always consult with qualified healthcare providers, especially for severe symptoms or medical emergencies.
                </p>
            </div>
        </div>
    </div>
</div>

<style>
.form-check-input:checked {
    background-color: #0d6efd;
    border-color: #0d6efd;
}

.form-check-label {
    cursor: pointer;
    transition: color 0.2s;
}

.form-check-label:hover {
    color: #0d6efd;
}

.card {
    border-radius: 15px;
}

.btn-lg {
    border-radius: 10px;
    padding: 12px 30px;
}

.alert {
    border-radius: 15px;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const symptomsForm = document.getElementById('symptomsForm');
    const resultsSection = document.getElementById('resultsSection');
    const analysisResults = document.getElementById('analysisResults');
    const submitBtn = document.getElementById('submitBtn');

    symptomsForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get selected symptoms
        const selectedSymptoms = [];
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
            selectedSymptoms.push(checkbox.value);
        });

        if (selectedSymptoms.length === 0) {
            alert('Please select at least one symptom.');
            return;
        }

        const severity = document.getElementById('severity').value;
        const duration = document.getElementById('duration').value;
        const additionalInfo = document.getElementById('additional_info').value;

        if (!severity || !duration) {
            alert('Please fill in all required fields.');
            return;
        }

        // Show loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing...';

        // Simulate AI analysis (in real app, this would call your AI service)
        setTimeout(() => {
            showResults(selectedSymptoms, severity, duration, additionalInfo);
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-search me-2"></i>Analyze Symptoms';
        }, 2000);
    });

    function showResults(symptoms, severity, duration, additionalInfo) {
        // Generate AI analysis based on symptoms
        const analysis = generateAnalysis(symptoms, severity, duration);
        
        // Display results
        analysisResults.innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-diagnosis me-2"></i>Likely Condition
                    </h5>
                    <div class="alert alert-info">
                        <strong>${analysis.disease}</strong>
                        <br><small class="text-muted">Based on your symptoms and severity</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5 class="text-success mb-3">
                        <i class="fas fa-pills me-2"></i>Recommended Treatment
                    </h5>
                    <div class="alert alert-success">
                        ${analysis.prescription}
                    </div>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-12">
                    <h5 class="text-warning mb-3">
                        <i class="fas fa-info-circle me-2"></i>Additional Recommendations
                    </h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <i class="fas fa-clock text-info me-2"></i>
                            <strong>Duration:</strong> ${duration.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                        </li>
                        <li class="list-group-item">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            <strong>Severity:</strong> ${severity.charAt(0).toUpperCase() + severity.slice(1)}
                        </li>
                        <li class="list-group-item">
                            <i class="fas fa-calendar-check text-success me-2"></i>
                            <strong>When to seek medical attention:</strong> ${analysis.when_to_seek_help}
                        </li>
                    </ul>
                </div>
            </div>
        `;

        // Show results section
        resultsSection.style.display = 'block';
        
        // Scroll to results
        resultsSection.scrollIntoView({ behavior: 'smooth' });
    }

    function generateAnalysis(symptoms, severity, duration) {
        // Simple AI logic based on symptoms
        const symptomAnalysis = {
            'fever': {
                disease: 'Upper Respiratory Infection',
                prescription: 'Rest, fluids, acetaminophen for fever. Monitor temperature and stay hydrated.',
                when_to_seek_help: 'If fever persists for more than 3 days or exceeds 103°F (39.4°C)'
            },
            'headache': {
                disease: 'Tension Headache',
                prescription: 'Rest in quiet room, hydration, over-the-counter pain relievers if needed.',
                when_to_seek_help: 'If headache is severe, sudden, or accompanied by other concerning symptoms'
            },
            'cough': {
                disease: 'Upper Respiratory Infection',
                prescription: 'Honey, warm fluids, humidifier, rest. Avoid irritants like smoke.',
                when_to_seek_help: 'If cough persists for more than 2 weeks or produces blood'
            },
            'fatigue': {
                disease: 'Viral Infection or Stress',
                prescription: 'Ensure 7-9 hours sleep, balanced diet, regular exercise, stress management.',
                when_to_seek_help: 'If fatigue is severe and persistent for more than 2 weeks'
            },
            'nausea': {
                disease: 'Gastritis or Viral Infection',
                prescription: 'Small, frequent meals, ginger tea, avoid spicy/fatty foods, rest.',
                when_to_seek_help: 'If nausea is severe, persistent, or accompanied by severe abdominal pain'
            }
        };

        // Find the most severe symptom
        let primarySymptom = symptoms[0];
        if (symptoms.includes('fever') && severity === 'severe') {
            primarySymptom = 'fever';
        } else if (symptoms.includes('chest_pain')) {
            primarySymptom = 'chest_pain';
        }

        // Get analysis for primary symptom
        const analysis = symptomAnalysis[primarySymptom] || symptomAnalysis['fever'];
        
        // Adjust based on severity
        if (severity === 'severe') {
            analysis.when_to_seek_help = 'Seek immediate medical attention - severe symptoms require professional evaluation';
        }

        return analysis;
    }
});
</script>
{% endblock %}
